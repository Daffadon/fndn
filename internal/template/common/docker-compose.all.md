# All Docker Compose

This is a reference file for all product that the config is generated by fndn.

## Database

### Postgresql

```yml
services:
  postgres:
    image: postgres:17.5-alpine3.22
    container_name: postgres_db
    environment:
      POSTGRES_USER: ${DB_USER}
      POSTGRES_PASSWORD: ${DB_PASSWORD}
      POSTGRES_DB: ${DB_NAME}
    restart: unless-stopped
    ports:
      - "5432:5432"
    volumes:
      - postgres_db_data:/var/lib/postgresql/data

volumes:
  postgres_db_data: {}
```

### MariaDB

```yml
services:
  maria_db:
    image: mariadb:12.0.2-ubi
    container_name: maria_db
    environment:
      MARIADB_ROOT_PASSWORD: ${DB_PASSWORD}
      MARIADB_USER: ${DB_USER}
      MARIADB_PASSWORD: ${DB_PASSWORD}
      MARIADB_DATABASE: ${DB_NAME}
    restart: unless-stopped
    ports:
      - "3306:3306"
    volumes:
      - maria_db_data:/var/lib/mysql

volumes:
  maria_db_data: {}
```

### Clickhouse

```yml
services:
  clickhouse:
    image: clickhouse:25.9.4.58-jammy
    container_name: clickhouse_db
    restart: unless-stopped
    environment:
      CLICKHOUSE_DB: ${DB_NAME}
      CLICKHOUSE_USER: ${DB_USER}
      CLICKHOUSE_PASSWORD: ${DB_PASSWORD}
    ports:
      - "9002:9000"
    volumes:
      - clickhouse_db_data:/var/lib/clickhouse

volumes:
  clickhouse_db_data: {}
```

### MongoDB

```yml
services:
  mongo_db:
    image: mongo:8.0-noble
    container_name: mongo_db
    restart: unless-stopped
    environment:
      MONGO_INITDB_ROOT_USERNAME: ${DB_USER}
      MONGO_INITDB_ROOT_PASSWORD: ${DB_PASSWORD}
      MONGO_INITDB_DATABASE: ${DB_NAME}
    ports:
      - "27017:27017"
    volumes:
      - mongo_db_data:/data/db

volumes:
  mongo_db_data: {}
```

### FerretDB

```yml
services:
  ferret_db:
    image: ghcr.io/ferretdb/ferretdb:2.5.0
    container_name: ferret_db
    restart: unless-stopped
    environment:
      - FERRETDB_POSTGRESQL_URL=postgres://${DB_USER}:${DB_PASSWORD}@postgres:5432/postgres
    ports:
      - "27017:27017"
    depends_on:
      - postgres

  #postgres_ferretdb (need to deployed when using ferretdb)
  postgres_ferret_db:
    image: ghcr.io/ferretdb/postgres-documentdb:17-0.106.0-ferretdb-2.5.0
    restart: unless-stopped
    environment:
      - POSTGRES_USER=${DB_USER}
      - POSTGRES_PASSWORD=${DB_PASSWORD}
      - POSTGRES_DB=postgres
    volumes:
      - postgres_ferret_db_data:/data/db

volumes:
  postgres_ferret_db_data: {}
```

### Neo4J

```yml
services:
  neo4j:
    image: neo4j:5.26.12-community-bullseye
    container_name: neo4j_db
    environment:
      NEO4J_AUTH: ${DB_USER}/${DB_PASSWORD}
      NEO4J_dbms_default__database: ${DB_NAME}
    restart: unless-stopped
    ports:
      - "7474:7474"
      - "7687:7687"
    volumes:
      - neo4j_db_data:/data

volumes:
  neo4j_db_data: {}
```

## Message Queue

### Nats

```yml
services:
  nats_mq:
    image: nats:2.11.9
    container_name: nats_mq
    restart: unless-stopped
    environment:
      - NATS_USER=${MQ_USER}
      - NATS_PASSWORD=${MQ_PASSWORD}
    ports:
      - "8081:8081"
    command: "-c /etc/nats/nats.conf --name nats -p 4221"
    volumes:
      - ./config/mq/nats-server.conf:/etc/nats/nats.conf
      - nats_data:/nats:rw
      - nats_jetstream_data:/jetstream/data:rw

volumes:
  nats_data: {}
  nats_jetstream_data: {}
```

### rabbitmq

```yml
services:
  rabbit_mq:
    image: rabbitmq:4.1.4-alpine
    container_name: rabbitmq_mq
    ports:
      - "5672:5672" # RabbitMQ main port
      - "15672:15672" # Management UI
    environment:
      RABBITMQ_DEFAULT_USER: ${MQ_USER}
      RABBITMQ_DEFAULT_PASS: ${MQ_PASSWORD}
      RABBITMQ_DEFINITIONS_FILE: /etc/rabbitmq/definitions.json
    volumes:
      - rabbitmq_data:/var/lib/rabbitmq
      - ./config/mq/definition.json:/etc/rabbitmq/definitions.json:ro

volumes:
  rabbitmq_data: {}
```

### kafka

```yml
services:
  kafka_mq:
    image: apache/kafka:3.9.1
    container_name: kafka_mq
    ports:
      - "9092:9092"
    environment:
      # --- KRaft mode ---
      KAFKA_NODE_ID: 1
      KAFKA_PROCESS_ROLES: broker,controller
      KAFKA_CONTROLLER_LISTENER_NAMES: CONTROLLER
      KAFKA_CONTROLLER_QUORUM_VOTERS: 1@project2_mq:9093
      CLUSTER_ID: secure-cluster-id

      # --- Listeners ---
      KAFKA_LISTENERS: SASL_PLAINTEXT://:9092,CONTROLLER://:9093
      KAFKA_ADVERTISED_LISTENERS: SASL_PLAINTEXT://localhost:9092
      KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: CONTROLLER:PLAINTEXT,SASL_PLAINTEXT:SASL_PLAINTEXT
      KAFKA_INTER_BROKER_LISTENER_NAME: SASL_PLAINTEXT

      # --- SASL/PLAIN Authentication ---
      KAFKA_SASL_ENABLED_MECHANISMS: PLAIN
      KAFKA_SASL_MECHANISM_INTER_BROKER_PROTOCOL: PLAIN
      KAFKA_OPTS: "-Djava.security.auth.login.config=/etc/kafka/jaas.conf"

      # --- Misc ---
      KAFKA_AUTO_CREATE_TOPICS_ENABLE: "true"

    volumes:
      - kafka_data:/var/lib/kafka/data
      - ./config/mq/jaas.conf:/etc/kafka/jaas.conf

volumes:
  kafka_data: {}
```

## Cache / In-memory Storage

### redis

```yml
services:
  redis_cache:
    image: redis:7.2
    container_name: redis_cache
    restart: unless-stopped
    ports:
      - "6379:6379"
    environment:
      - CACHE_PASSWORD=${CACHE_PASSWORD}
    command: ["redis-server", "--requirepass", "$CACHE_PASSWORD"]
    volumes:
      - redis_data:/data

volumes:
  redis_data: {}
```

### valkey

```yml
services:
  valkey_cache:
    image: valkey/valkey:9-alpine3.22
    container_name: valkey_cache
    restart: unless-stopped
    ports:
      - "6379:6379"
    command: ["valkey-server", "--aclfile", "/etc/valkey/valkey.acl"]
    volumes:
      - valkey_data:/data
      - ./config/cache/valkey.acl:/etc/valkey/valkey.acl

volumes:
  valkey_data: {}
```

### dragonfly

```yml
services:
  dragonfly_cache:
    image: ghcr.io/dragonflydb/dragonfly:v1.34.1
    container_name: dragonfly_cache
    restart: unless-stopped
    ports:
      - "6379:6379"
    environment:
      - CACHE_PASSWORD=${CACHE_PASSWORD}
    command:
      [
        "dragonfly",
        "--requirepass",
        "$CACHE_PASSWORD",
        "--proactor_threads",
        "2",
      ]
    volumes:
      - dragonfly_data:/data

volumes:
  dragonfly_data: {}
```

### redict

```yml
services:
  redict_cache:
    image: registry.redict.io/redict:7.3.6-scratch
    container_name: redict_cache
    restart: unless-stopped
    ports:
      - "6379:6379"
    environment:
      - CACHE_PASSWORD=${CACHE_PASSWORD}
    command:
      [
        "redict-server",
        "--requirepass",
        "$CACHE_PASSWORD",
        "--maxmemory",
        "512mb",
        "--maxmemory-policy",
        "allkeys-lru",
      ]
    volumes:
      - redict_data:/data

volumes:
  redict_data: {}
```

## Object Storage

### Rustfs

```yml
services:
  rustfs_storage:
    image: rustfs/rustfs:1.0.0-alpha.76
    container_name: rustfs_storage
    environment:
      - RUSTFS_CONSOLE_ENABLE=true
      - RUSTFS_ADDRESS=0.0.0.0:9000
      - RUSTFS_CONSOLE_ADDRESS=0.0.0.0:9001
      - RUSTFS_EXTERNAL_ADDRESS=:9000 # Same as internal since no port mapping
      - RUSTFS_CORS_ALLOWED_ORIGINS=*
      - RUSTFS_CONSOLE_CORS_ALLOWED_ORIGINS=*
      - RUSTFS_ACCESS_KEY=${OS_ROOT_USER}
      - RUSTFS_SECRET_KEY=${OS_ROOT_PASSWORD}
    restart: unless-stopped
    ports:
      - "9000:9000"
      - "9001:9001"
    healthcheck:
      test:
        [
          "CMD",
          "sh",
          "-c",
          "curl -f http://localhost:9000/health && curl -f http://localhost:9001/rustfs/console/health",
        ]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    volumes:
      - rustfs_data:/data

volumes:
  rustfs_data: {}
```

### seaweedfs master

```yml
services:
  seaweedfs_storage_master:
    image: chrislusf/seaweedfs:4.03
    container_name: seaweedfs_storage_master
    command: "master -ip=seaweedfs_storage_master -port=9333 -disableHttp -volumePreallocate=false"
    healthcheck:
      test: wget http://seaweedfs_storage_master:9333/cluster/status -O -
      interval: 10s
      timeout: 5s
      retries: 999
    restart: unless-stopped
    volumes:
      - seaweedfs_master_data:/data

  # seaweedfs volume
  seaweedfs_storage_volume:
    image: chrislusf/seaweedfs:4.03
    container_name: seaweedfs_storage_volume
    command: "volume -ip=seaweedfs_storage_volume -port=8080 -mserver=seaweedfs_storage_master:9333"
    healthcheck:
      test: wget http://seaweedfs_storage_volume:8080/status -O -
      interval: 10s
      timeout: 5s
      retries: 999
    depends_on:
      seaweedfs_storage_master:
        condition: service_healthy
    restart: unless-stopped
    volumes:
      - seaweedfs_volume_data:/data

  # seaweed filer
  seaweedfs_storage_filer:
    image: chrislusf/seaweedfs:4.03
    container_name: seaweedfs_storage_filer
    command: "filer -master=seaweedfs_storage_master:9333 -ip=seaweedfs_storage_filer -ip.bind=0.0.0.0 -port=8888 -port.readonly=8889"
    ports:
      - "8889:8889"
      - "8888:8888"
    healthcheck:
      test: wget http://seaweedfs_storage_filer:8888/ -O -
      interval: 10s
      timeout: 5s
      retries: 999
    depends_on:
      seaweedfs_storage_master:
        condition: service_healthy
      seaweedfs_storage_volume:
        condition: service_healthy
    restart: unless-stopped
    volumes:
      - seaweedfs_filer_data:/data

  # seaweed s3
  seaweedfs_storage_s3:
    image: chrislusf/seaweedfs:4.03
    container_name: project1_storage_s3
    command: "s3 -filer=seaweedfs_storage_filer:8888 -port=9000 -ip.bind=0.0.0.0 -config=/etc/seaweedfs/s3.json"
    healthcheck:
      test: wget http://seaweedfs_storage_s3:9000/ -O -
      interval: 10s
      timeout: 5s
      retries: 999
    ports:
      - "9000:9000"
    depends_on:
      seaweedfs_storage_filer:
        condition: service_healthy
    restart: unless-stopped
    volumes:
      - ./config/storage/s3.json:/etc/seaweedfs/s3.json:ro

volumes:
  seaweedfs_master_data: {}
  seaweedfs_volume_data: {}
  seaweedfs_filer_data: {}
```

### minio

```yml
services:
  minio_storage:
    image: minio/minio:RELEASE.2025-05-24T17-08-30Z-cpuv1
    container_name: minio_storage
    environment:
      MINIO_ROOT_USER: ${OS_ROOT_USER}
      MINIO_ROOT_PASSWORD: ${OS_ROOT_PASSWORD}
    restart: unless-stopped
    ports:
      - "9000:80"
      - "9001:9001"
    command: server /data  --address ":80" --console-address ":9001"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:80/minio/health/live"]
      interval: 30s
      timeout: 10s
      retries: 5
    volumes:
      - minio_data:/data
volumes:
  minio_data: {}
```
